<ion-header>
  <ion-navbar>
    <ion-title text-wrap>
      {{ investigation.labTitle }}
    </ion-title>
  </ion-navbar>
</ion-header>

<ion-content>
  <ion-list inset no-lines>
    <ion-item *ngIf="investigation.sampleInterval">
      <h5>Sample Interval: {{ investigation.sampleInterval }}ms</h5>
    </ion-item>
    <ion-item>
      <h5>
        Status:
        <span *ngIf="connectedDevices?.length">Connected</span>
        <span *ngIf="!connectedDevices?.length">Not connected</span>
      </h5>

      <div *ngFor="let device of connectedDevices">
        <h5 *ngIf="device?.id">Sensor tag: {{ device.id }}</h5>
      </div>
    </ion-item>
  </ion-list>

  <ion-list inset no-lines *ngIf="!datasetsAvailable?.length">
    <ion-item text-wrap>
      <h5>No sensors enabled to run the investigation!</h5>
      <h6>Please recheck if at least one parameter (eg IR) has been enabled for the chosen sensor (eg Temperature).</h6>
    </ion-item>
  </ion-list>

  <ion-list class="sensor-display" inset no-lines *ngIf="sensors?.length">
    <ion-item text-wrap *ngFor="let sensor of sensors">
      <h2>{{ sensor.name }}</h2>

      <ion-grid *ngIf="sensor.parameters?.length>0">
        <ion-row>
            <h6>Enabled parameters:</h6>
        </ion-row>
        <ion-row *ngFor="let param of sensor.parameters">
          <ion-col no-padding no-margin>
            <h6><b>{{ param.key }}</b></h6>
          </ion-col>
          <ion-col no-padding no-margin>
            <h6>{{ param.value ? 'ON': 'OFF' }}</h6>
          </ion-col>
        </ion-row>
      </ion-grid>

      <div *ngFor="let device of connectedDevices">
        <h5 *ngIf="sensor?.value">
          <span *ngIf="sensor.value[device.id]">
            Device {{ device.id }} -
            <b>{{ sensor.value[device.id] }}</b>
          </span>
        </h5>
      </div>

      <div *ngIf="!!sensor.config.graph.graphdisplay || !!sensor.config.graph.display">
        <canvas id="{{ sensor.name }}" margin-top></canvas>
      </div>

      <ion-grid class="grid-container" *ngIf="!!sensor.config.grid.griddisplay || !!sensor.config.grid.display">
        <ion-row>
          <ion-col>
            <h5>
              <b>Press any button on sensor tag or tap on grid to record a value</b>
            </h5>
            <h5>
              <b>
                Please note : Tapping on grid will rewrite any existing value
              </b>
            </h5>
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col class="grid" *ngFor="let grid of sensor.config.grids" [ngStyle]="{'max-width': maxGridWidth, 'min-width': maxGridWidth}"
            (click)="captureDeviceDataForGrid(grid, sensor)">
            <div class="grid-data" [id]="grid.id">
              <h4 *ngIf="!grid.value">{{ grid.number }}</h4>
              <div *ngFor="let device of connectedDevices">
                <div *ngIf="grid.value && grid.value[device.id]?.value">
                  <!-- <h3>Sensor {{ device.id }}</h3> -->
                  <h6>
                    {{ grid.value[device.id].value }}
                  </h6>
                </div>
              </div>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-item>
  </ion-list>

</ion-content>

<ion-footer flex *ngIf="display.graph && datasetsAvailable?.length>0">
  <button ion-button no-margin full no-border-radius color="secondary" *ngIf="graphsStartedAtLeastOnce" (click)="saveGraphData()">
    Save graph data
  </button>

  <button ion-button no-margin full no-border-radius *ngIf="!graphsStarted" (click)="startGraphs()">
    Start graphs
  </button>

  <button ion-button no-margin half no-border-radius *ngIf="graphsStarted" color="danger" (click)="stopGraphs()">
    Stop graphs
  </button>

  <button ion-button no-margin half no-border-radius *ngIf="graphsStarted" color="dark" (click)="resetGraphs()">
    Reset graphs
  </button>
</ion-footer>

<ion-footer flex *ngIf="display.grid && datasetsAvailable?.length>0">
  <button ion-button no-margin full no-border-radius color="secondary" (click)="saveGridData()">
    Save grid data
  </button>

  <button ion-button no-margin full no-border-radius color="dark" (click)="resetGrid()">
    Reset grid
  </button>
</ion-footer>
